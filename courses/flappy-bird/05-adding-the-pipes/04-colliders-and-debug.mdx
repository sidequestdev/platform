---
sidebar_position: 4
title: Colliders and Debug
---

# Colliders and Debug

Let's add some box colliders to our pipes and make sure we can see them when we toggle debug (press the `d` key).

## Box Colliders

Update the pipe entity to add a box collider:

```ts title="src/entities/pipe.ts +{3,24-29,35-47}
export class Pipe {
  height: number;
  boxCollider: BoxCollider;
  game: Game;
  position: Vector2d;
  rimSpriteData: SpriteData;
  sliceSpriteData: SpriteData;
  spriteSheet: HTMLImageElement;
  type: "top" | "bottom";

  constructor(options: PipeOptions) {
    this.game = options.game;
    this.position = options.position;
    this.rimSpriteData = options.rimSpriteData;
    this.sliceSpriteData = options.sliceSpriteData;
    this.spriteSheet = options.spriteSheet;
    this.type = options.type;

    this.height =
      this.type === "top"
        ? this.position.y
        : this.game.config.gameHeight - this.position.y;

    this.boxCollider = new BoxCollider(
      0,
      0,
      this.rimSpriteData.width,
      this.height
    );
  }

  public draw(context: CanvasRenderingContext2D) {
    // ... previous code ...

    if (this.game.debug) {
      context.fillStyle = "red";
      context.globalAlpha = 0.5;

      context.fillRect(
        this.position.x + this.boxCollider.offsetX,
        this.type === "top" ? 0 : this.position.y + this.boxCollider.offsetY,
        this.boxCollider.width,
        this.boxCollider.height
      );

      context.globalAlpha = 1;
    }
  }
}
```

We're applying our usual 50% opacity on the collider to make it easier to see the underlying sprite. We're applying some logic to set the colliders `y` position based on the `type` as well.

When you check the browser you should see the colliders after pressing the `d` key.

<ThemeImage
  alt="Pipes reference lines diagram"
  width="352"
  height="576"
  light={{
    src: "/images/courses/flappy-bird/05-adding-the-pipes/pipes-with-initial-colliders.png",
  }}
  dark={{
    src: "/images/courses/flappy-bird/05-adding-the-pipes/pipes-with-initial-colliders.png",
  }}
/>

The collider is as wide as the pipe rim. Let's change that so the collider is a _little_ more forgiving and matches the size of the pipe body.

<AlertInfo title="What about the pipe body sprite?">
Maybe you're thinking we could use the pipe body sprite to determine the
collider width? That would be a good idea, but they're actually the same width.
We did this on purpose so we don't have to do any `x` offsetting when drawing
the pipe body.

We'll instead favour an offset on the box collider.

</AlertInfo>

## Collider Sizing

We're going to store the pipe collider `x offset` and the `width` in our config:

```ts title="src/config.ts +{14-19}
export const config = {
  /**
   * In pixels
   */
  gameWidth: 352,

  /**
   * In pixels
   */
  gameHeight: 576,

  debug: false,

  pipe: {
    collider: {
      offsetX: 4,
      width: 56,
    },
  },
};

export type Config = typeof config;
```

The reason we store the x offset is to account for some of the transparent pixels in the pipe body slice sprite. These transparent pixels exist to make the pipe body sprite match the width of the pipe rim sprites.

Now we'll update the pipe entity to make use of this information:

```ts title="src/entities/pipe.ts +{17-22}
export class Pipe {
  // ...

  constructor(options: PipeOptions) {
    this.game = options.game;
    this.position = options.position;
    this.rimSpriteData = options.rimSpriteData;
    this.sliceSpriteData = options.sliceSpriteData;
    this.spriteSheet = options.spriteSheet;
    this.type = options.type;

    this.height =
      this.type === "top"
        ? this.position.y
        : this.game.config.gameHeight - this.position.y;

    this.boxCollider = new BoxCollider(
      0 + this.game.config.pipe.collider.offsetX,
      0,
      this.game.config.pipe.collider.width,
      this.height
    );
  }

  // ...
}
```

Which will get us a slightly tighter collider:

<ThemeImage
  alt="Pipes reference lines diagram"
  width="352"
  height="576"
  light={{
    src: "/images/courses/flappy-bird/05-adding-the-pipes/pipes-with-final-colliders.png",
  }}
  dark={{
    src: "/images/courses/flappy-bird/05-adding-the-pipes/pipes-with-final-colliders.png",
  }}
/>

Much better! Let's move on to some clean up.
